(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[974],{1166:(e,t,a)=>{"use strict";a.d(t,{$:()=>r});var s=a(5155);a(2115);var n=a(2821);function r(e){let{variant:t="primary",size:a="md",isLoading:r,children:l,className:i,disabled:o,...c}=e;return(0,s.jsxs)("button",{disabled:o||r,className:(0,n.$)("inline-flex items-center justify-center font-medium rounded-lg transition-colors focus:outline-none focus:ring-2 focus:ring-offset-2 disabled:opacity-50 disabled:cursor-not-allowed",{"bg-amber-500 hover:bg-amber-600 text-white focus:ring-amber-500":"primary"===t,"bg-white hover:bg-slate-50 text-slate-700 border border-slate-200 focus:ring-slate-400":"secondary"===t,"text-slate-600 hover:text-slate-900 hover:bg-slate-100 focus:ring-slate-400":"ghost"===t,"bg-red-500 hover:bg-red-600 text-white focus:ring-red-500":"danger"===t,"text-xs px-3 py-1.5 gap-1":"sm"===a,"text-sm px-4 py-2 gap-2":"md"===a,"text-base px-6 py-3 gap-2":"lg"===a},i),...c,children:[r&&(0,s.jsxs)("svg",{className:"animate-spin h-4 w-4",fill:"none",viewBox:"0 0 24 24",children:[(0,s.jsx)("circle",{className:"opacity-25",cx:"12",cy:"12",r:"10",stroke:"currentColor",strokeWidth:"4"}),(0,s.jsx)("path",{className:"opacity-75",fill:"currentColor",d:"M4 12a8 8 0 018-8V0C5.373 0 0 5.373 0 12h4z"})]}),l]})}},2234:(e,t,a)=>{Promise.resolve().then(a.bind(a,3300))},3300:(e,t,a)=>{"use strict";a.r(t),a.d(t,{default:()=>eo});var s=a(5155),n=a(2115);let r=[{id:"riyadh",nameEn:"Riyadh",nameAr:"الرياض",lat:24.7136,lon:46.6753,region:"Central",avgDNI:5.8},{id:"jeddah",nameEn:"Jeddah",nameAr:"جدة",lat:21.4858,lon:39.1925,region:"Western",avgDNI:5.5},{id:"makkah",nameEn:"Makkah",nameAr:"مكة المكرمة",lat:21.3891,lon:39.8579,region:"Western",avgDNI:5.6},{id:"madinah",nameEn:"Madinah",nameAr:"المدينة المنورة",lat:24.5247,lon:39.5692,region:"Western",avgDNI:5.7},{id:"dammam",nameEn:"Dammam",nameAr:"الدمام",lat:26.4207,lon:50.0888,region:"Eastern",avgDNI:5.4},{id:"khobar",nameEn:"Al-Khobar",nameAr:"الخبر",lat:26.2172,lon:50.1971,region:"Eastern",avgDNI:5.4},{id:"dhahran",nameEn:"Dhahran",nameAr:"الظهران",lat:26.2361,lon:50.0393,region:"Eastern",avgDNI:5.5},{id:"taif",nameEn:"Taif",nameAr:"الطائف",lat:21.2854,lon:40.4158,region:"Western",avgDNI:5.9},{id:"tabuk",nameEn:"Tabuk",nameAr:"تبوك",lat:28.3838,lon:36.555,region:"Northern",avgDNI:6},{id:"abha",nameEn:"Abha",nameAr:"أبها",lat:18.2164,lon:42.5053,region:"Southern",avgDNI:5.2},{id:"jizan",nameEn:"Jizan",nameAr:"جيزان",lat:16.8892,lon:42.5511,region:"Southern",avgDNI:5.1},{id:"najran",nameEn:"Najran",nameAr:"نجران",lat:17.4923,lon:44.1277,region:"Southern",avgDNI:5.7},{id:"hail",nameEn:"Hail",nameAr:"حائل",lat:27.5114,lon:41.6931,region:"Northern",avgDNI:5.9},{id:"buraidah",nameEn:"Buraidah",nameAr:"بريدة",lat:26.326,lon:43.975,region:"Central",avgDNI:5.8},{id:"jubail",nameEn:"Al Jubail",nameAr:"الجبيل",lat:27.0174,lon:49.658,region:"Eastern",avgDNI:5.4},{id:"yanbu",nameEn:"Yanbu",nameAr:"ينبع",lat:24.0899,lon:38.0618,region:"Western",avgDNI:5.5}],l=r.find(e=>"riyadh"===e.id),i={tariff:{tier1MaxKwhPerMonth:6e3,tier1RateSarPerKwh:.18,tier2RateSarPerKwh:.3,source:"Saudi Electricity Company (SEC) residential tariff, effective Jan 2018. https://www.se.com.sa/en-us/customers/pages/tariff.aspx",lastVerified:"2024-11",note:"Commercial rates differ slightly; this tool defaults to residential. Custom rate input overrides all tiers."},pvSystem:{defaultWPerM2:216,defaultPackingFactor:1,defaultSystemLossPercent:14,defaultInverterEffPercent:96,defaultDegradationPctPerYear:.5,source:'Fraunhofer ISE 2012 "Photovoltaics Report" for degradation; PVGIS documentation for system loss default. https://joint-research-centre.ec.europa.eu/pvgis-photovoltaic-geographical-information-system_en'},selfConsumption:{conservativeLow:.2,conservativeHigh:.4,profileLow:.35,profileHigh:.6,source:'Fraunhofer ISE 2015 "Self-consumption of solar electricity" — typical residential without battery storage: 20–40%. https://www.ise.fraunhofer.de/content/dam/ise/de/documents/publications/studies/recent-facts-about-photovoltaics-in-germany.pdf',rationale:"A range is shown instead of a single value because self-consumption is highly sensitive to occupancy patterns and appliance timing, which are unknown without 15-min interval smart-meter data."},economics:{defaultInstallCostSarPerKwp:3500,defaultOmCostSarPerKwpPerYear:50,discountRatePercent:5,projectLifeYears:25,gridCO2IntensityKgPerKwh:.57,source:"Install cost: REPDO Saudi Arabia 2023 market survey & Enerdata. CO2 factor: IEA 2022 Electricity CO2 Emissions Factors. Discount rate: Saudi bank market rates 2024."}},{tier1MaxKwhPerMonth:o,tier1RateSarPerKwh:c,tier2RateSarPerKwh:d}=i.tariff;function m(e){let t=Math.max(0,e),a=Math.min(t,o),s=Math.max(0,t-o),n=a*c+s*d;return{monthlyBill:Math.round(100*n)/100,annualBill:Math.round(12*n*100)/100,blendedRate:Math.round(1e4*(t>0?n/t:c))/1e4,tier1Kwh:a,tier2Kwh:s}}function u(e,t){return m(Math.max(0,e-t))}let x=["Jan","Feb","Mar","Apr","May","Jun","Jul","Aug","Sep","Oct","Nov","Dec"],h=[.65,.65,.75,.8,1,1.4,1.8,1.8,1.4,1,.8,.65],p=h.reduce((e,t)=>e+t,0),g=h.map(e=>e/p*12),f={city:l,roof:{usableAreaM2:100,tiltDeg:22,azimuthDeg:180,shadingLoss:5,useOptimalAngles:!1},consumption:{monthlyKwh:3e3,hasAC:!0,summerPeakMultiplier:1.8},advanced:{wPerM2:i.pvSystem.defaultWPerM2,packingFactor:i.pvSystem.defaultPackingFactor,systemLoss:i.pvSystem.defaultSystemLossPercent,inverterEff:i.pvSystem.defaultInverterEffPercent,degradationPct:i.pvSystem.defaultDegradationPctPerYear,projectLifeYears:i.economics.projectLifeYears,installCostPerKwp:i.economics.defaultInstallCostSarPerKwp,omCostPerKwpPerYear:i.economics.defaultOmCostSarPerKwpPerYear},export:{enabled:!1,creditRatePerKwh:null,utilityProgram:""}};var b=a(1166);function v(e){let{value:t,onChange:a}=e,[l,i]=(0,n.useState)(""),[o,c]=(0,n.useState)(!1),d=l.length>0?r.filter(e=>e.nameEn.toLowerCase().includes(l.toLowerCase())||e.nameAr.includes(l)):null,m=d?{Results:d}:function(){let e={};for(let t of r)e[t.region]||(e[t.region]=[]),e[t.region].push(t);return e}(),u=["Central","Western","Eastern","Northern","Southern"],x=Object.keys(m).sort((e,t)=>u.indexOf(e)-u.indexOf(t));return(0,s.jsxs)("div",{className:"space-y-1",children:[(0,s.jsx)("label",{className:"block text-sm font-medium text-slate-700",children:"City"}),(0,s.jsxs)("div",{className:"relative",children:[(0,s.jsxs)("button",{type:"button",onClick:()=>c(!o),className:"w-full flex items-center justify-between rounded-lg border border-slate-200 bg-white px-3 py-2.5 text-sm text-left focus:outline-none focus:ring-2 focus:ring-amber-500",children:[(0,s.jsx)("span",{className:t?"text-slate-900":"text-slate-400",children:t?"".concat(t.nameEn," — ").concat(t.region):"Select a city…"}),(0,s.jsx)("svg",{className:"h-4 w-4 text-slate-400 flex-shrink-0",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",children:(0,s.jsx)("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M19 9l-7 7-7-7"})})]}),o&&(0,s.jsxs)("div",{className:"absolute z-50 mt-1 w-full bg-white border border-slate-200 rounded-lg shadow-lg",children:[(0,s.jsx)("div",{className:"p-2 border-b border-slate-100",children:(0,s.jsx)("input",{autoFocus:!0,type:"text",placeholder:"Search cities…",value:l,onChange:e=>i(e.target.value),className:"w-full px-3 py-1.5 text-sm rounded-md border border-slate-200 focus:outline-none focus:ring-2 focus:ring-amber-500"})}),(0,s.jsxs)("div",{className:"max-h-64 overflow-y-auto",children:[x.map(e=>(0,s.jsxs)("div",{children:[(0,s.jsx)("div",{className:"px-3 py-1.5 text-xs font-semibold text-slate-400 uppercase tracking-wider bg-slate-50",children:e}),m[e].map(e=>(0,s.jsxs)("button",{type:"button",onClick:()=>{a(e),c(!1),i("")},className:"w-full flex items-center justify-between px-3 py-2 text-sm hover:bg-amber-50 text-left",children:[(0,s.jsx)("span",{className:"text-slate-900",children:e.nameEn}),(0,s.jsx)("span",{className:"text-slate-400 text-xs",children:e.nameAr})]},e.id))]},e)),0===x.length&&(0,s.jsx)("p",{className:"px-3 py-4 text-sm text-slate-500 text-center",children:"No cities found"})]})]})]}),t&&(0,s.jsxs)("p",{className:"text-xs text-slate-500",children:["Coordinates: ",t.lat.toFixed(4),"\xb0N, ",t.lon.toFixed(4),"\xb0E \xb7 Avg DNI: ",t.avgDNI," kWh/m\xb2/day"]})]})}var y=a(2821);function j(e){let{label:t,hint:a,error:n,suffix:r,prefix:l,className:i,id:o,...c}=e,d=null!=o?o:null==t?void 0:t.toLowerCase().replace(/\s+/g,"-");return(0,s.jsxs)("div",{className:"space-y-1",children:[t&&(0,s.jsx)("label",{htmlFor:d,className:"block text-sm font-medium text-slate-700",children:t}),(0,s.jsxs)("div",{className:"relative flex items-center",children:[l&&(0,s.jsx)("span",{className:"absolute left-3 text-sm text-slate-500 pointer-events-none",children:l}),(0,s.jsx)("input",{id:d,className:(0,y.$)("w-full rounded-lg border bg-white text-sm text-slate-900 placeholder:text-slate-400","focus:outline-none focus:ring-2 focus:ring-amber-500 focus:border-transparent","disabled:bg-slate-50 disabled:text-slate-500 disabled:cursor-not-allowed",n?"border-red-400":"border-slate-200",l?"pl-8 pr-4 py-2.5":"px-3 py-2.5",r?"pr-12":"",i),...c}),r&&(0,s.jsx)("span",{className:"absolute right-3 text-sm text-slate-500 pointer-events-none",children:r})]}),a&&!n&&(0,s.jsx)("p",{className:"text-xs text-slate-500",children:a}),n&&(0,s.jsx)("p",{className:"text-xs text-red-500",children:n})]})}let N=[{label:"None",value:0,description:"No shading on the roof"},{label:"Partial",value:5,description:"Some shading from trees or structures"},{label:"Heavy",value:15,description:"Significant shading, large obstructions"}],S=[{label:"South (best)",azimuth:180},{label:"South-East",azimuth:135},{label:"South-West",azimuth:225},{label:"East",azimuth:90},{label:"West",azimuth:270},{label:"North",azimuth:0}];function w(e){let{value:t,onChange:a}=e,[r,l]=(0,n.useState)("direct"),[i,o]=(0,n.useState)(""),[c,d]=(0,n.useState)(""),[m,u]=(0,n.useState)(80);function x(){let e=parseFloat(i),t=parseFloat(c);isNaN(e)||isNaN(t)||a({usableAreaM2:Math.round(e*t*(m/100))})}return(0,s.jsxs)("div",{className:"space-y-4",children:[(0,s.jsxs)("div",{className:"flex gap-2",children:[(0,s.jsx)("button",{type:"button",onClick:()=>l("direct"),className:"flex-1 py-2 px-3 rounded-lg text-sm font-medium transition-colors ".concat("direct"===r?"bg-amber-500 text-white":"bg-slate-100 text-slate-600 hover:bg-slate-200"),children:"Enter area directly"}),(0,s.jsx)("button",{type:"button",onClick:()=>l("dimensions"),className:"flex-1 py-2 px-3 rounded-lg text-sm font-medium transition-colors ".concat("dimensions"===r?"bg-amber-500 text-white":"bg-slate-100 text-slate-600 hover:bg-slate-200"),children:"Enter length \xd7 width"})]}),"direct"===r?(0,s.jsx)(j,{label:"Usable rooftop area",type:"number",min:10,max:5e3,step:5,suffix:"m\xb2",value:t.usableAreaM2,onChange:e=>a({usableAreaM2:parseFloat(e.target.value)||0}),hint:"Usable = after excluding HVAC units, parapets, walkways, and shaded zones"}):(0,s.jsxs)("div",{className:"space-y-3",children:[(0,s.jsxs)("div",{className:"grid grid-cols-2 gap-3",children:[(0,s.jsx)(j,{label:"Length",type:"number",min:1,step:.5,suffix:"m",value:i,onChange:e=>{o(e.target.value)},onBlur:x}),(0,s.jsx)(j,{label:"Width",type:"number",min:1,step:.5,suffix:"m",value:c,onChange:e=>{d(e.target.value)},onBlur:x})]}),(0,s.jsxs)("div",{className:"space-y-1",children:[(0,s.jsxs)("label",{className:"block text-sm font-medium text-slate-700",children:["Usable portion: ",m,"%"]}),(0,s.jsx)("input",{type:"range",min:50,max:100,step:5,value:m,onChange:e=>{u(parseInt(e.target.value)),x()},className:"w-full accent-amber-500"}),(0,s.jsxs)("div",{className:"flex justify-between text-xs text-slate-400",children:[(0,s.jsx)("span",{children:"50% (many obstructions)"}),(0,s.jsx)("span",{children:"100% (clear roof)"})]})]}),t.usableAreaM2>0&&(0,s.jsxs)("p",{className:"text-sm text-amber-700 bg-amber-50 rounded-lg px-3 py-2",children:["Usable area: ",(0,s.jsxs)("strong",{children:[t.usableAreaM2," m\xb2"]})]})]}),(0,s.jsxs)("div",{className:"space-y-1",children:[(0,s.jsxs)("label",{className:"block text-sm font-medium text-slate-700",children:["Roof orientation ",(0,s.jsx)("span",{className:"font-normal text-slate-400",children:"(optional)"})]}),(0,s.jsx)("div",{className:"grid grid-cols-3 gap-2",children:S.map(e=>(0,s.jsx)("button",{type:"button",onClick:()=>a({azimuthDeg:e.azimuth,useOptimalAngles:!1}),className:"py-1.5 px-2 rounded-lg text-xs font-medium transition-colors ".concat(t.azimuthDeg!==e.azimuth||t.useOptimalAngles?"bg-slate-100 text-slate-600 hover:bg-slate-200":"bg-amber-500 text-white"),children:e.label},e.azimuth))}),(0,s.jsx)("button",{type:"button",onClick:()=>a({useOptimalAngles:!0}),className:"w-full py-1.5 px-3 rounded-lg text-xs font-medium transition-colors ".concat(t.useOptimalAngles?"bg-amber-500 text-white":"bg-slate-100 text-slate-600 hover:bg-slate-200"),children:"I don't know — use PVGIS optimal angles"})]}),!t.useOptimalAngles&&(0,s.jsxs)("div",{className:"space-y-1",children:[(0,s.jsxs)("label",{className:"block text-sm font-medium text-slate-700",children:["Tilt angle: ",t.tiltDeg,"\xb0"]}),(0,s.jsx)("input",{type:"range",min:0,max:45,step:1,value:t.tiltDeg,onChange:e=>a({tiltDeg:parseInt(e.target.value)}),className:"w-full accent-amber-500"}),(0,s.jsxs)("div",{className:"flex justify-between text-xs text-slate-400",children:[(0,s.jsx)("span",{children:"0\xb0 (flat)"}),(0,s.jsx)("span",{children:"22\xb0 (optimal KSA)"}),(0,s.jsx)("span",{children:"45\xb0 (steep)"})]})]}),(0,s.jsxs)("div",{className:"space-y-1",children:[(0,s.jsx)("label",{className:"block text-sm font-medium text-slate-700",children:"Shading level"}),(0,s.jsx)("div",{className:"grid grid-cols-3 gap-2",children:N.map(e=>(0,s.jsx)("button",{type:"button",onClick:()=>a({shadingLoss:e.value}),title:e.description,className:"py-2 px-3 rounded-lg text-xs font-medium transition-colors ".concat(t.shadingLoss===e.value?"bg-amber-500 text-white":"bg-slate-100 text-slate-600 hover:bg-slate-200"),children:e.label},e.value))})]})]})}function k(e){let{value:t,onChange:a}=e,[r,l]=(0,n.useState)("kwh"),[i,m]=(0,n.useState)(""),[u,x]=(0,n.useState)(null);return(0,s.jsxs)("div",{className:"space-y-4",children:[(0,s.jsxs)("div",{className:"flex gap-2",children:[(0,s.jsx)("button",{type:"button",onClick:()=>l("kwh"),className:"flex-1 py-2 px-3 rounded-lg text-sm font-medium transition-colors ".concat("kwh"===r?"bg-amber-500 text-white":"bg-slate-100 text-slate-600 hover:bg-slate-200"),children:"I know my kWh"}),(0,s.jsx)("button",{type:"button",onClick:()=>l("sar"),className:"flex-1 py-2 px-3 rounded-lg text-sm font-medium transition-colors ".concat("sar"===r?"bg-amber-500 text-white":"bg-slate-100 text-slate-600 hover:bg-slate-200"),children:"I only have SAR amount"})]}),"kwh"===r?(0,s.jsx)(j,{label:"Monthly electricity consumption",type:"number",min:100,max:5e4,step:100,suffix:"kWh/mo",value:t.monthlyKwh,onChange:e=>a({monthlyKwh:parseFloat(e.target.value)||0}),hint:"From your last electricity bill. Use the average of 3–6 months for best accuracy."}):(0,s.jsxs)("div",{className:"space-y-2",children:[(0,s.jsx)(j,{label:"Monthly electricity bill",type:"number",min:10,max:5e4,step:10,prefix:"SAR",value:i,onChange:e=>(function(e){m(e);let t=parseFloat(e);if(!isNaN(t)&&t>0){let e=function(e){if(e<=0)return null;let t=o*c;return e<=t?e/c:o+(e-t)/d}(t);x(e?Math.round(e):null),e&&a({monthlyKwh:Math.round(e)})}})(e.target.value),hint:"Enter your bill amount — we'll estimate kWh using SEC tiered rates"}),null!==u&&(0,s.jsxs)("div",{className:"rounded-lg bg-amber-50 border border-amber-200 px-3 py-2",children:[(0,s.jsxs)("p",{className:"text-sm text-amber-800",children:["Estimated consumption: ",(0,s.jsxs)("strong",{children:[u.toLocaleString()," kWh/mo"]})]}),(0,s.jsx)("p",{className:"text-xs text-amber-600 mt-0.5",children:"This is an estimate based on SEC residential tariff tiers. The actual value may differ due to fixed charges, VAT, or your customer category."})]})]}),(0,s.jsx)("div",{className:"rounded-lg bg-slate-50 border border-slate-200 px-3 py-2.5",children:(0,s.jsxs)("p",{className:"text-xs text-slate-500",children:[(0,s.jsx)("span",{className:"font-medium text-slate-700",children:"Residential tariff applied"})," — Tier 1: 0.18 SAR/kWh (0–6,000 kWh/mo), Tier 2: 0.30 SAR/kWh (above 6,000 kWh/mo). Commercial or custom rates can be set in Advanced Settings."]})})]})}function C(e){var t;let{value:a,onChange:n}=e;return(0,s.jsxs)("div",{className:"space-y-3",children:[(0,s.jsxs)("div",{children:[(0,s.jsx)("label",{className:"block text-sm font-medium text-slate-700 mb-2",children:"Do you export excess electricity to the grid?"}),(0,s.jsxs)("div",{className:"grid grid-cols-3 gap-2",children:[[{label:"No",enabled:!1},{label:"Yes",enabled:!0}].map(e=>(0,s.jsx)("button",{type:"button",onClick:()=>n({enabled:e.enabled}),className:"py-2 px-3 rounded-lg text-sm font-medium transition-colors ".concat(a.enabled===e.enabled?"bg-amber-500 text-white":"bg-slate-100 text-slate-600 hover:bg-slate-200"),children:e.label},e.label)),(0,s.jsx)("button",{type:"button",onClick:()=>n({enabled:!1}),className:"py-2 px-3 rounded-lg text-sm font-medium bg-slate-100 text-slate-600 hover:bg-slate-200",children:"Not sure"})]})]}),a.enabled&&(0,s.jsxs)("div",{className:"space-y-2 border-l-2 border-amber-300 pl-4",children:[(0,s.jsx)(j,{label:"Export credit rate",type:"number",min:0,max:.5,step:.01,prefix:"SAR",suffix:"/kWh",placeholder:"e.g. 0.06",value:null!=(t=a.creditRatePerKwh)?t:"",onChange:e=>{let t=parseFloat(e.target.value);n({creditRatePerKwh:isNaN(t)?null:t})},hint:"From your SEC net-billing agreement. Leave blank if unknown — export credit is never assumed."}),null===a.creditRatePerKwh&&(0,s.jsx)("div",{className:"rounded-lg bg-blue-50 border border-blue-200 px-3 py-2",children:(0,s.jsxs)("p",{className:"text-xs text-blue-700",children:[(0,s.jsx)("span",{className:"font-medium",children:"Export credit not set."})," Savings will be calculated without export revenue. Enter your confirmed rate from SEC to include it."]})})]})]})}function M(e){let{value:t,onChange:a,onReset:r}=e,[l,o]=(0,n.useState)(!1),c=[{key:"wPerM2",label:"Panel power density",unit:"W/m\xb2",min:150,max:350,step:1,source:i.pvSystem.source},{key:"packingFactor",label:"Packing factor",unit:"(0–1)",min:.5,max:1,step:.05,source:i.pvSystem.source},{key:"systemLoss",label:"System losses",unit:"%",min:0,max:50,step:.5,source:i.pvSystem.source},{key:"degradationPct",label:"Annual degradation",unit:"%/yr",min:0,max:2,step:.1,source:i.pvSystem.source},{key:"installCostPerKwp",label:"Install cost",unit:"SAR/kWp",min:1e3,max:1e4,step:100,source:i.economics.source},{key:"omCostPerKwpPerYear",label:"O&M cost",unit:"SAR/kWp/yr",min:0,max:500,step:10,source:i.economics.source},{key:"projectLifeYears",label:"Project lifetime",unit:"years",min:10,max:30,step:1,source:i.economics.source}];return(0,s.jsxs)("div",{className:"border border-slate-200 rounded-lg overflow-hidden",children:[(0,s.jsxs)("button",{type:"button",onClick:()=>o(!l),className:"w-full flex items-center justify-between px-4 py-3 bg-slate-50 hover:bg-slate-100 text-sm font-medium text-slate-700",children:[(0,s.jsx)("span",{children:"Advanced assumptions"}),(0,s.jsx)("svg",{className:"h-4 w-4 text-slate-400 transition-transform ".concat(l?"rotate-180":""),fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",children:(0,s.jsx)("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M19 9l-7 7-7-7"})})]}),l&&(0,s.jsxs)("div",{className:"p-4 space-y-4",children:[c.map(e=>(0,s.jsxs)("div",{className:"space-y-1",children:[(0,s.jsx)(j,{label:e.label,type:"number",min:e.min,max:e.max,step:e.step,suffix:e.unit,value:t[e.key],onChange:t=>a({[e.key]:parseFloat(t.target.value)||0})}),(0,s.jsxs)("p",{className:"text-xs text-slate-400",children:["Source: ",e.source.split(".")[0]]})]},e.key)),(0,s.jsx)(b.$,{variant:"ghost",size:"sm",onClick:r,type:"button",children:"Reset all to defaults"})]})]})}let P=[{id:"location",label:"Location",icon:"\uD83D\uDCCD"},{id:"roof",label:"Roof",icon:"\uD83C\uDFE0"},{id:"consumption",label:"Usage",icon:"⚡"},{id:"options",label:"Options",icon:"⚙️"}];function A(e){var t;let{estimator:a}=e,{inputs:n,step:r,setStep:l,updateCity:i,updateRoof:o,updateConsumption:c,updateAdvanced:d,updateExport:m,resetToDefaults:u,runEstimation:x,isLoading:h,defaultInputs:p}=a,g=P.findIndex(e=>e.id===r);return(0,s.jsxs)("div",{className:"bg-white rounded-xl border border-slate-200 shadow-sm overflow-hidden",children:[(0,s.jsx)("div",{className:"flex border-b border-slate-100",children:P.map((e,t)=>(0,s.jsxs)("button",{type:"button",onClick:()=>l(e.id),className:"flex-1 py-3 text-center transition-colors ".concat(e.id===r?"bg-amber-50 border-b-2 border-amber-500 text-amber-700":t<g?"text-green-600 hover:bg-slate-50":"text-slate-400 hover:bg-slate-50"),children:[(0,s.jsx)("div",{className:"text-lg",children:e.icon}),(0,s.jsx)("div",{className:"text-xs font-medium hidden sm:block",children:e.label})]},e.id))}),(0,s.jsxs)("div",{className:"p-5 space-y-5",children:["location"===r&&(0,s.jsxs)(s.Fragment,{children:[(0,s.jsxs)("div",{children:[(0,s.jsx)("h2",{className:"text-base font-semibold text-slate-900",children:"Select your city"}),(0,s.jsx)("p",{className:"text-xs text-slate-500 mt-0.5",children:"Solar data will be fetched from PVGIS for this location."})]}),(0,s.jsx)(v,{value:n.city,onChange:i})]}),"roof"===r&&(0,s.jsxs)(s.Fragment,{children:[(0,s.jsxs)("div",{children:[(0,s.jsx)("h2",{className:"text-base font-semibold text-slate-900",children:"Your rooftop"}),(0,s.jsx)("p",{className:"text-xs text-slate-500 mt-0.5",children:"Enter the usable area available for solar panels."})]}),(0,s.jsx)(w,{value:n.roof,onChange:o})]}),"consumption"===r&&(0,s.jsxs)(s.Fragment,{children:[(0,s.jsxs)("div",{children:[(0,s.jsx)("h2",{className:"text-base font-semibold text-slate-900",children:"Electricity consumption"}),(0,s.jsx)("p",{className:"text-xs text-slate-500 mt-0.5",children:"From your last electricity bill. The more accurate, the better."})]}),(0,s.jsx)(k,{value:n.consumption,onChange:c})]}),"options"===r&&(0,s.jsxs)(s.Fragment,{children:[(0,s.jsxs)("div",{children:[(0,s.jsx)("h2",{className:"text-base font-semibold text-slate-900",children:"Options"}),(0,s.jsx)("p",{className:"text-xs text-slate-500 mt-0.5",children:"Export to grid and installation cost (optional)."})]}),(0,s.jsx)(C,{value:n.export,onChange:m}),(0,s.jsx)(M,{value:n.advanced,onChange:d,onReset:()=>d(p.advanced)})]}),(0,s.jsxs)("div",{className:"flex gap-3 pt-2",children:[g>0&&(0,s.jsx)(b.$,{variant:"secondary",onClick:function(){let e=g-1;e>=0&&l(P[e].id)},type:"button",className:"flex-1",children:"← Back"}),"options"!==r?(0,s.jsx)(b.$,{variant:"primary",onClick:function(){let e=g+1;e<P.length&&l(P[e].id)},disabled:!function(){switch(r){case"location":return null!==n.city;case"roof":return n.roof.usableAreaM2>0;case"consumption":return n.consumption.monthlyKwh>0;default:return!0}}(),type:"button",className:"flex-1",children:"Next →"}):(0,s.jsx)(b.$,{variant:"primary",onClick:x,isLoading:h,type:"button",className:"flex-1",children:h?"Calculating…":"☀️ Calculate My Solar Savings"})]}),"options"===r&&(0,s.jsxs)("div",{className:"text-xs text-slate-500 bg-slate-50 rounded-lg px-3 py-2 space-y-0.5",children:[(0,s.jsxs)("div",{children:["\uD83D\uDCCD ",null==(t=n.city)?void 0:t.nameEn]}),(0,s.jsxs)("div",{children:["\uD83C\uDFE0 ",n.roof.usableAreaM2," m\xb2 usable roof"]}),(0,s.jsxs)("div",{children:["⚡ ",n.consumption.monthlyKwh.toLocaleString()," kWh/mo"]})]})]})]})}function E(e,t){var a;let s=null!=(a=null==t?void 0:t.decimals)?a:0,n=new Intl.NumberFormat("en-US",{minimumFractionDigits:s,maximumFractionDigits:s}).format(e);return"SAR ".concat(n)}function F(e){let t=new Intl.NumberFormat("en-US",{minimumFractionDigits:0,maximumFractionDigits:3}).format(e);return"".concat(t," kWp")}function I(e,t){let a=null!=t?t:0,s=new Intl.NumberFormat("en-US",{minimumFractionDigits:a,maximumFractionDigits:a}).format(e);return"".concat(s,"%")}function K(e){let{result:t}=e,{savings:a,economics:n,tariff:r,annualProductionKwh:l}=t,i=a.minSarPerYear/12,o=a.maxSarPerYear/12,c=r.annualBill/r.blendedRate,d=c>0?Math.min(100,Math.round(a.maxKwhSelfConsumedPerYear/c*100)):0,m=n?n.co2OffsetTonnesPerYear:57e-5*l;return(0,s.jsxs)("div",{style:{display:"flex",flexDirection:"column",gap:"12px"},children:[(0,s.jsxs)("div",{style:{backgroundColor:"var(--bg-card)",border:"1px solid var(--accent)",borderRadius:"16px",padding:"24px"},children:[(0,s.jsx)("div",{className:"accent-line",style:{marginBottom:"12px"}}),(0,s.jsx)("p",{style:{fontSize:"0.75rem",color:"var(--text-secondary)",margin:"0 0 6px",textTransform:"uppercase",letterSpacing:"0.08em"},children:"Estimated Monthly Savings"}),(0,s.jsx)("p",{style:{fontSize:"2rem",fontWeight:800,color:"var(--accent)",margin:"0 0 4px",fontFamily:"var(--font-outfit)"},children:function(e,t){let a=new Intl.NumberFormat("en-US",{maximumFractionDigits:0}).format(e),s=new Intl.NumberFormat("en-US",{maximumFractionDigits:0}).format(t);return"SAR ".concat(a," – ").concat(s," / month")}(i,o)}),(0,s.jsx)("p",{style:{fontSize:"0.8rem",color:"var(--text-secondary)",margin:0},children:"Based on 20–40% self-consumption range"})]}),(0,s.jsxs)("div",{style:{display:"grid",gridTemplateColumns:"repeat(2, 1fr)",gap:"12px"},children:[(0,s.jsx)(D,{label:"Bill coverage",value:I(d),subtext:"of your electricity need"}),(0,s.jsx)(D,{label:"Annual savings",value:function(e,t,a){let s=new Intl.NumberFormat("en-US",{minimumFractionDigits:0,maximumFractionDigits:0}).format(e),n=new Intl.NumberFormat("en-US",{minimumFractionDigits:0,maximumFractionDigits:0}).format(t),r="SAR ".concat(s," – ").concat(n);if(a){let e=a.startsWith("SAR")?a.slice(3):" ".concat(a);return"".concat(r," ").concat(e)}return r}(a.minSarPerYear,a.maxSarPerYear,"SAR/yr"),subtext:"conservative estimate"}),n&&(0,s.jsx)(D,{label:"Payback period",value:"".concat(n.simplePaybackYears.toFixed(1)," years"),subtext:"to recover investment",highlight:!0}),(0,s.jsx)(D,{label:"CO\\u2082 offset",value:function(e){let t=new Intl.NumberFormat("en-US",{minimumFractionDigits:0,maximumFractionDigits:1}).format(e);return"".concat(t," tonnes CO₂/yr")}(m),subtext:"emissions avoided"})]})]})}function D(e){let{label:t,value:a,subtext:n,highlight:r}=e;return(0,s.jsxs)("div",{style:{backgroundColor:"var(--bg-card)",border:"1px solid ".concat(r?"var(--accent)":"var(--border)"),borderRadius:"16px",padding:"16px"},children:[(0,s.jsx)("p",{style:{fontSize:"0.7rem",color:"var(--text-secondary)",margin:"0 0 4px",textTransform:"uppercase",letterSpacing:"0.05em"},children:t}),(0,s.jsx)("p",{style:{fontSize:"1rem",fontWeight:700,color:r?"var(--accent)":"var(--text-primary)",margin:"0 0 2px",fontFamily:"var(--font-outfit)"},children:a}),(0,s.jsx)("p",{style:{fontSize:"0.7rem",color:"var(--text-secondary)",margin:0},children:n})]})}var R=a(6265),z=a(9863),W=a(8425),L=a(7734),Y=a(3697),O=a(3420),T=a(46),B=a(2321),U=a(9476),J=a(4621);function V(e){let{children:t,className:a,padding:r="md"}=e,[l,i]=n.useState(!1);return(0,s.jsx)("div",{className:(0,y.$)({"p-0":"none"===r,"p-4":"sm"===r,"p-5":"md"===r,"p-6":"lg"===r},a),style:{backgroundColor:"var(--bg-card)",border:"1px solid ".concat(l?"var(--accent)":"var(--border)"),borderRadius:"16px",boxShadow:l?"0 10px 30px rgba(0,0,0,0.15)":void 0,transform:l?"translateY(-3px)":"translateY(0)",transition:"all 0.3s ease-out"},onMouseEnter:()=>i(!0),onMouseLeave:()=>i(!1),children:t})}function $(e){let{children:t,className:a}=e;return(0,s.jsx)("h3",{className:(0,y.$)("text-sm font-semibold uppercase tracking-wide",a),style:{color:"var(--text-secondary)"},children:t})}function _(e){let{children:t,variant:a="default",className:n}=e;return(0,s.jsx)("span",{className:(0,y.$)("inline-flex items-center gap-1 px-2 py-0.5 rounded-full text-xs font-medium",{"bg-slate-100 text-slate-600":"default"===a,"bg-green-100 text-green-700":"success"===a,"bg-amber-100 text-amber-700":"warning"===a,"bg-blue-100 text-blue-700":"info"===a},n),children:t})}function G(e){var t;let{active:a,payload:n,label:r}=e;if(!a||!(null==n?void 0:n.length))return null;let l=null==(t=n[0])?void 0:t.payload;return(0,s.jsxs)("div",{className:"bg-white border border-slate-200 rounded-lg shadow-lg p-3 text-xs space-y-1",children:[(0,s.jsx)("p",{className:"font-semibold text-slate-700",children:r}),(0,s.jsxs)("p",{className:"text-amber-600",children:["Production: ",l.productionKwh.toLocaleString()," kWh"]}),(0,s.jsxs)("p",{className:"text-slate-600",children:["Consumption: ",l.consumptionKwh.toLocaleString()," kWh"]}),(0,s.jsxs)("p",{className:"text-green-700 font-medium",children:["Savings: SAR ",l.savingsMinSar.toLocaleString()," – ",l.savingsMaxSar.toLocaleString()]})]})}function H(e){let{data:t}=e,a=t.map(e=>({month:e.month,production:e.productionKwh,consumption:e.consumptionKwh,savingsMin:e.savingsMinSar,savingsMax:e.savingsMaxSar,productionKwh:e.productionKwh,consumptionKwh:e.consumptionKwh,savingsMinSar:e.savingsMinSar,savingsMaxSar:e.savingsMaxSar}));return(0,s.jsxs)(V,{children:[(0,s.jsxs)("div",{className:"flex items-center justify-between mb-4",children:[(0,s.jsx)($,{children:"Monthly Production vs Consumption"}),(0,s.jsxs)("div",{className:"flex gap-2",children:[(0,s.jsx)(_,{variant:"warning",children:"Solar production"}),(0,s.jsx)(_,{variant:"success",children:"Savings range"})]})]}),(0,s.jsx)(R.u,{width:"100%",height:300,children:(0,s.jsxs)(z.X,{data:a,margin:{top:4,right:16,left:0,bottom:0},children:[(0,s.jsx)(W.d,{strokeDasharray:"3 3",stroke:"#f1f5f9"}),(0,s.jsx)(L.W,{dataKey:"month",tick:{fontSize:11,fill:"#94a3b8"},axisLine:!1,tickLine:!1}),(0,s.jsx)(Y.h,{yAxisId:"kwh",orientation:"left",tick:{fontSize:10,fill:"#94a3b8"},axisLine:!1,tickLine:!1,tickFormatter:e=>"".concat((e/1e3).toFixed(0),"k"),label:{value:"kWh",angle:-90,position:"insideLeft",fontSize:10,fill:"#94a3b8"}}),(0,s.jsx)(Y.h,{yAxisId:"sar",orientation:"right",tick:{fontSize:10,fill:"#94a3b8"},axisLine:!1,tickLine:!1,tickFormatter:e=>"".concat(e),label:{value:"SAR",angle:90,position:"insideRight",fontSize:10,fill:"#94a3b8"}}),(0,s.jsx)(O.m,{content:(0,s.jsx)(G,{})}),(0,s.jsx)(T.s,{wrapperStyle:{fontSize:11,color:"#64748b"},formatter:e=>{var t;return null!=(t=({production:"Solar Production (kWh)",consumption:"Consumption (kWh)",savingsMax:"Savings High (SAR)",savingsMin:"Savings Low (SAR)"})[e])?t:e}}),(0,s.jsx)(B.yP,{yAxisId:"kwh",dataKey:"production",fill:"#f59e0b",radius:[3,3,0,0],name:"production",maxBarSize:32}),(0,s.jsx)(U.N1,{yAxisId:"kwh",type:"monotone",dataKey:"consumption",stroke:"#94a3b8",strokeWidth:1.5,dot:!1,name:"consumption",strokeDasharray:"4 4"}),(0,s.jsx)(J.Gk,{yAxisId:"sar",type:"monotone",dataKey:"savingsMax",fill:"#bbf7d0",stroke:"none",name:"savingsMax",fillOpacity:.5}),(0,s.jsx)(U.N1,{yAxisId:"sar",type:"monotone",dataKey:"savingsMin",stroke:"#16a34a",strokeWidth:1.5,dot:!1,name:"savingsMin"}),(0,s.jsx)(U.N1,{yAxisId:"sar",type:"monotone",dataKey:"savingsMax",stroke:"#15803d",strokeWidth:1.5,dot:!1,strokeDasharray:"5 3"})]})}),(0,s.jsx)("p",{className:"text-xs text-slate-400 mt-2 text-center",children:"Shaded green band = savings range (conservative 20–40% self-consumption). Dashed grey line = monthly average consumption."})]})}function q(e){let{label:t,value:a,min:n,max:r,step:l,unit:i,onChange:o,disabled:c,disabledReason:d}=e;return(0,s.jsxs)("div",{className:"space-y-1",children:[(0,s.jsxs)("div",{className:"flex justify-between text-xs",children:[(0,s.jsx)("span",{className:"font-medium text-slate-700",children:t}),(0,s.jsx)("span",{className:c?"text-slate-300":"text-amber-600 font-semibold",children:c?"—":"".concat(a).concat(i)})]}),(0,s.jsx)("input",{type:"range",min:n,max:r,step:l,value:a,disabled:c,onChange:e=>o(parseFloat(e.target.value)),className:"w-full accent-amber-500 disabled:accent-slate-200"}),c&&d&&(0,s.jsx)("p",{className:"text-xs text-slate-400",children:d}),!c&&(0,s.jsxs)("div",{className:"flex justify-between text-xs text-slate-400",children:[(0,s.jsxs)("span",{children:[n,i]}),(0,s.jsxs)("span",{children:[r,i]})]})]})}function X(e){var t;let{estimator:a}=e,{inputs:n,updateAdvanced:r,updateExport:l,runEstimation:i}=a,o=n.export.enabled;return(0,s.jsxs)(V,{children:[(0,s.jsxs)("div",{className:"flex items-center justify-between mb-4",children:[(0,s.jsx)($,{children:"Sensitivity"}),(0,s.jsx)("button",{type:"button",onClick:i,className:"text-xs text-amber-600 hover:text-amber-700 font-medium",children:"Recalculate ↻"})]}),(0,s.jsxs)("div",{className:"space-y-5",children:[(0,s.jsx)(q,{label:"System losses",value:n.advanced.systemLoss,min:5,max:30,step:.5,unit:"%",onChange:e=>r({systemLoss:e})}),(0,s.jsx)(q,{label:"Panel power density",value:n.advanced.wPerM2,min:180,max:310,step:2,unit:" W/m\xb2",onChange:e=>r({wPerM2:e})}),(0,s.jsx)(q,{label:"Export credit rate",value:null!=(t=n.export.creditRatePerKwh)?t:0,min:0,max:.3,step:.01,unit:" SAR/kWh",disabled:!o||null===n.export.creditRatePerKwh,disabledReason:o?"Enter a confirmed rate in Options to enable this slider":"Enable net billing in Options to set export rate",onChange:e=>l({creditRatePerKwh:e})})]}),(0,s.jsx)("p",{className:"text-xs text-slate-400 mt-4",children:"Adjust sliders, then click Recalculate to update results."})]})}function Q(e){let{usableAreaM2:t,systemKwp:a,roofCoverage:n,panelCount:r}=e,l=Math.PI,i=n/100*Math.PI;function o(e,t){return{x:80+t*Math.cos(e),y:100-t*Math.sin(e)}}let c=o(l,60),d=o(0,60),m=o(l-i,60),u="M ".concat(c.x," ").concat(c.y," A ").concat(60," ").concat(60," 0 0 1 ").concat(d.x," ").concat(d.y),x=i>0?"M ".concat(c.x," ").concat(c.y," A ").concat(60," ").concat(60," 0 ").concat(+(i>Math.PI/2)," 1 ").concat(m.x," ").concat(m.y):"";return(0,s.jsxs)(V,{children:[(0,s.jsx)($,{className:"mb-3",children:"Roof Utilisation"}),(0,s.jsxs)("div",{className:"flex flex-col items-center",children:[(0,s.jsxs)("svg",{width:160,height:110,viewBox:"0 0 ".concat(160," ").concat(110),children:[(0,s.jsx)("path",{d:u,fill:"none",stroke:"#e2e8f0",strokeWidth:14,strokeLinecap:"round"}),x&&(0,s.jsx)("path",{d:x,fill:"none",stroke:n>=70?"#f59e0b":n>=40?"#fbbf24":"#e2e8f0",strokeWidth:14,strokeLinecap:"round",style:{transition:"stroke-dashoffset 0.6s ease"}}),(0,s.jsxs)("text",{x:80,y:96,textAnchor:"middle",fontSize:"22",fontWeight:"bold",fill:"#1e293b",children:[n,"%"]}),(0,s.jsx)("text",{x:80,y:114,textAnchor:"middle",fontSize:"10",fill:"#94a3b8",children:"roof used"})]}),(0,s.jsxs)("div",{className:"w-full mt-2 space-y-1 text-xs text-slate-600",children:[(0,s.jsxs)("div",{className:"flex justify-between",children:[(0,s.jsx)("span",{children:"Usable area"}),(0,s.jsxs)("span",{className:"font-medium",children:[t," m\xb2"]})]}),(0,s.jsxs)("div",{className:"flex justify-between",children:[(0,s.jsx)("span",{children:"System size"}),(0,s.jsx)("span",{className:"font-medium text-amber-600",children:F(a)})]}),(0,s.jsxs)("div",{className:"flex justify-between",children:[(0,s.jsx)("span",{children:"Est. panels"}),(0,s.jsxs)("span",{className:"font-medium",children:["~",r]})]})]})]})]})}function Z(e){let{economics:t}=e,a=t.simplePaybackYears,n=Math.min(a/25*100,100);return(0,s.jsxs)("div",{style:{backgroundColor:"var(--bg-card)",border:"1px solid var(--border)",borderRadius:"16px",padding:"24px",transition:"all 0.3s ease-out"},children:[(0,s.jsxs)("div",{style:{display:"flex",alignItems:"center",gap:"12px",marginBottom:"20px"},children:[(0,s.jsx)("div",{className:"accent-line"}),(0,s.jsx)("h3",{style:{fontFamily:"var(--font-outfit)",fontWeight:600,fontSize:"1rem",color:"var(--text-primary)",margin:0},children:"Investment Analysis"})]}),(0,s.jsxs)("div",{style:{display:"flex",alignItems:"center",gap:"20px",marginBottom:"20px"},children:[(0,s.jsxs)("div",{style:{position:"relative",width:80,height:80,flexShrink:0},children:[(0,s.jsxs)("svg",{width:"80",height:"80",viewBox:"0 0 80 80",children:[(0,s.jsx)("circle",{cx:"40",cy:"40",r:"34",fill:"none",stroke:"var(--border)",strokeWidth:"6"}),(0,s.jsx)("circle",{cx:"40",cy:"40",r:"34",fill:"none",stroke:"var(--accent)",strokeWidth:"6",strokeLinecap:"round",strokeDasharray:"".concat(2*Math.PI*34),strokeDashoffset:"".concat(2*Math.PI*34*(1-n/100)),transform:"rotate(-90 40 40)",style:{transition:"stroke-dashoffset 1s ease"}})]}),(0,s.jsxs)("div",{style:{position:"absolute",inset:0,display:"flex",flexDirection:"column",alignItems:"center",justifyContent:"center"},children:[(0,s.jsx)("span",{style:{fontSize:"1.1rem",fontWeight:700,color:"var(--accent)",fontFamily:"var(--font-outfit)"},children:a<100?a.toFixed(1):"25+"}),(0,s.jsx)("span",{style:{fontSize:"0.6rem",color:"var(--text-secondary)"},children:"yrs"})]})]}),(0,s.jsxs)("div",{children:[(0,s.jsxs)("p",{style:{fontSize:"1.1rem",fontWeight:600,color:"var(--text-primary)",margin:"0 0 4px"},children:[a<1?"< 1 year":a>25?"> 25 years":"".concat(a.toFixed(1)," years")," payback"]}),(0,s.jsx)("p",{style:{fontSize:"0.8rem",color:"var(--text-secondary)",margin:0},children:"of a 25-year panel lifespan"})]})]}),(0,s.jsxs)("div",{style:{display:"grid",gridTemplateColumns:"1fr 1fr",gap:"12px"},children:[(0,s.jsx)(ee,{label:"Cost per panel",value:function(e){if(e<=0)return"N/A";let t=new Intl.NumberFormat("en-US",{minimumFractionDigits:0,maximumFractionDigits:0}).format(e);return"SAR ".concat(t," / panel")}(t.costPerPanel)}),(0,s.jsx)(ee,{label:"Cost per kWp",value:function(e){if(e<=0)return"N/A";let t=new Intl.NumberFormat("en-US",{minimumFractionDigits:0,maximumFractionDigits:0}).format(e);return"SAR ".concat(t," / kWp")}(t.costPerKwp)}),(0,s.jsx)(ee,{label:"25-yr net gain",value:E(t.cumulativeSavings25yr),highlight:t.cumulativeSavings25yr>0}),(0,s.jsx)(ee,{label:"NPV (today)",value:E(t.npv25Years),highlight:t.npv25Years>0})]})]})}function ee(e){let{label:t,value:a,highlight:n}=e;return(0,s.jsxs)("div",{style:{backgroundColor:"var(--bg-secondary)",borderRadius:"10px",padding:"12px"},children:[(0,s.jsx)("p",{style:{fontSize:"0.7rem",color:"var(--text-secondary)",margin:"0 0 4px",textTransform:"uppercase",letterSpacing:"0.05em"},children:t}),(0,s.jsx)("p",{style:{fontSize:"0.9rem",fontWeight:600,margin:0,color:n?"var(--accent)":"var(--text-primary)",fontFamily:'"JetBrains Mono", monospace'},children:a})]})}function et(e){var t;let{comparisons:a}=e,n=[{icon:"☀️",label:"Like getting free electricity for",value:(t=a.monthsFreePerYear)<=0?"0 months":"".concat(t.toFixed(1)," months free"),subtext:"every year"},{icon:"\uD83C\uDF33",label:"Equivalent to planting",value:"".concat(a.treesEquivalentPerYear," trees"),subtext:"annually (CO₂ offset)"},{icon:"\uD83D\uDE97",label:"Like avoiding",value:"".concat(a.carTripsAvoided," car trips"),subtext:"Riyadh → Jeddah per year"},{icon:"\uD83D\uDCA1",label:"Enough electricity for",value:"".concat(a.householdsEquivalent," homes"),subtext:"average Saudi household"}];return(0,s.jsxs)("div",{style:{backgroundColor:"var(--bg-card)",border:"1px solid var(--border)",borderRadius:"16px",padding:"24px",transition:"all 0.3s ease-out"},children:[(0,s.jsxs)("div",{style:{display:"flex",alignItems:"center",gap:"12px",marginBottom:"20px"},children:[(0,s.jsx)("div",{className:"accent-line"}),(0,s.jsx)("h3",{style:{fontFamily:"var(--font-outfit)",fontWeight:600,fontSize:"1rem",color:"var(--text-primary)",margin:0},children:"What This Means for You"})]}),(0,s.jsx)("div",{style:{display:"grid",gridTemplateColumns:"repeat(2, 1fr)",gap:"12px"},children:n.map(e=>(0,s.jsxs)("div",{style:{backgroundColor:"var(--bg-secondary)",borderRadius:"12px",padding:"16px",display:"flex",flexDirection:"column",gap:"6px"},children:[(0,s.jsx)("span",{style:{fontSize:"1.5rem"},children:e.icon}),(0,s.jsx)("p",{style:{fontSize:"0.7rem",color:"var(--text-secondary)",margin:0},children:e.label}),(0,s.jsx)("p",{style:{fontSize:"1rem",fontWeight:700,color:"var(--accent)",margin:0,fontFamily:"var(--font-outfit)"},children:e.value}),(0,s.jsx)("p",{style:{fontSize:"0.7rem",color:"var(--text-secondary)",margin:0},children:e.subtext})]},e.label))})]})}function ea(e){let{result:t,inputs:a}=e,[r,l]=(0,n.useState)(!1),i=["Jan","Feb","Mar","Apr","May","Jun","Jul","Aug","Sep","Oct","Nov","Dec"];return(0,s.jsxs)("div",{style:{border:"1px solid var(--border)",borderRadius:"16px",overflow:"hidden"},children:[(0,s.jsxs)("button",{onClick:()=>l(!r),style:{width:"100%",display:"flex",alignItems:"center",justifyContent:"space-between",padding:"16px 24px",backgroundColor:"var(--bg-secondary)",border:"none",cursor:"pointer",color:"var(--text-secondary)",fontSize:"0.85rem",fontFamily:"var(--font-outfit)"},children:[(0,s.jsx)("span",{children:"Technical Details — For Engineers & Installers"}),(0,s.jsx)("span",{style:{transform:r?"rotate(180deg)":"rotate(0)",transition:"transform 0.3s ease"},children:"▼"})]}),r&&(0,s.jsxs)("div",{style:{padding:"24px",backgroundColor:"var(--bg-card)"},children:[(0,s.jsxs)("div",{style:{marginBottom:"24px"},children:[(0,s.jsx)("h4",{style:{fontSize:"0.8rem",fontWeight:600,color:"var(--text-secondary)",textTransform:"uppercase",letterSpacing:"0.08em",margin:"0 0 12px"},children:"System Specifications"}),(0,s.jsxs)("div",{style:{display:"grid",gridTemplateColumns:"repeat(3, 1fr)",gap:"8px"},children:[(0,s.jsx)(es,{label:"System size",value:F(t.sizing.systemKwp)}),(0,s.jsx)(es,{label:"Panel count",value:"".concat(t.sizing.panelCount," panels")}),(0,s.jsx)(es,{label:"Annual production",value:function(e){let t=new Intl.NumberFormat("en-US",{minimumFractionDigits:0,maximumFractionDigits:0}).format(e);return"".concat(t," kWh")}(t.annualProductionKwh)}),(0,s.jsx)(es,{label:"Specific yield",value:"".concat(Math.round(t.annualProductionKwh/t.sizing.systemKwp)," kWh/kWp")}),(0,s.jsx)(es,{label:"System losses",value:I(a.advanced.systemLoss)}),(0,s.jsx)(es,{label:"Roof coverage",value:I(t.sizing.roofCoverage)})]})]}),(0,s.jsxs)("div",{children:[(0,s.jsx)("h4",{style:{fontSize:"0.8rem",fontWeight:600,color:"var(--text-secondary)",textTransform:"uppercase",letterSpacing:"0.08em",margin:"0 0 12px"},children:"Monthly Production (kWh)"}),(0,s.jsx)("div",{style:{display:"grid",gridTemplateColumns:"repeat(6, 1fr)",gap:"6px"},children:t.monthlyBreakdown.slice(0,12).map((e,t)=>(0,s.jsxs)("div",{style:{textAlign:"center",backgroundColor:"var(--bg-secondary)",borderRadius:"8px",padding:"8px 4px"},children:[(0,s.jsx)("p",{style:{fontSize:"0.65rem",color:"var(--text-secondary)",margin:"0 0 4px"},children:i[t]}),(0,s.jsx)("p",{style:{fontSize:"0.8rem",fontWeight:600,color:"var(--text-primary)",margin:0,fontFamily:'"JetBrains Mono", monospace'},children:Math.round(e.productionKwh)})]},t))})]}),(0,s.jsx)("p",{style:{fontSize:"0.7rem",color:"var(--text-secondary)",marginTop:"20px",marginBottom:0,borderTop:"1px solid var(--border)",paddingTop:"16px"},children:"Solar irradiance data: PVGIS-SARAH3 (Joint Research Centre, European Commission). Self-consumption range: Fraunhofer ISE literature (20–40%). Estimates only — verify with a qualified solar installer before investing."})]})]})}function es(e){let{label:t,value:a}=e;return(0,s.jsxs)("div",{style:{backgroundColor:"var(--bg-secondary)",borderRadius:"8px",padding:"8px 12px"},children:[(0,s.jsx)("p",{style:{fontSize:"0.65rem",color:"var(--text-secondary)",margin:"0 0 2px"},children:t}),(0,s.jsx)("p",{style:{fontSize:"0.8rem",fontWeight:600,color:"var(--text-primary)",margin:0,fontFamily:'"JetBrains Mono", monospace'},children:a})]})}function en(e){let{className:t}=e;return(0,s.jsx)("div",{className:(0,y.$)("animate-pulse bg-slate-200 rounded",t)})}function er(){return(0,s.jsxs)("div",{className:"bg-white rounded-xl border border-slate-200 p-5 space-y-3",children:[(0,s.jsx)(en,{className:"h-4 w-24"}),(0,s.jsx)(en,{className:"h-8 w-36"}),(0,s.jsx)(en,{className:"h-3 w-20"})]})}function el(){return(0,s.jsxs)("div",{className:"space-y-6",children:[(0,s.jsx)("div",{className:"grid grid-cols-2 md:grid-cols-4 gap-4",children:[void 0,void 0,void 0,void 0].map((e,t)=>(0,s.jsx)(er,{},t))}),(0,s.jsxs)("div",{className:"bg-white rounded-xl border border-slate-200 p-5",children:[(0,s.jsx)(en,{className:"h-4 w-32 mb-4"}),(0,s.jsx)(en,{className:"h-64 w-full"})]})]})}function ei(){let[e,t]=(0,n.useState)(null);return((0,n.useEffect)(()=>{t("light"===localStorage.getItem("theme")?"light":"dark")},[]),null===e)?null:(0,s.jsx)("button",{onClick:()=>{let a="dark"===e?"light":"dark";t(a),document.documentElement.setAttribute("data-theme",a),localStorage.setItem("theme",a)},"aria-label":"dark"===e?"Switch to light mode":"Switch to dark mode",style:{background:"transparent",border:"1px solid var(--border)",borderRadius:"8px",padding:"6px 10px",cursor:"pointer",color:"var(--text-secondary)",fontSize:"16px",lineHeight:1,transition:"transform 0.3s ease, border-color 0.3s ease"},onMouseEnter:e=>{e.currentTarget.style.transform="rotate(30deg)"},onMouseLeave:e=>{e.currentTarget.style.transform="rotate(0deg)"},children:"dark"===e?"☀️":"\uD83C\uDF19"})}function eo(){let e=function(){let[e,t]=(0,n.useState)(f),[a,s]=(0,n.useState)(null),[r,l]=(0,n.useState)(null),[o,c]=(0,n.useState)(!1),[d,h]=(0,n.useState)("location"),[p,b]=(0,n.useState)("conservative"),v=(0,n.useCallback)(e=>{t(t=>({...t,city:e}))},[]),y=(0,n.useCallback)(e=>{t(t=>({...t,roof:{...t.roof,...e}}))},[]),j=(0,n.useCallback)(e=>{t(t=>({...t,consumption:{...t.consumption,...e}}))},[]),N=(0,n.useCallback)(e=>{t(t=>({...t,advanced:{...t.advanced,...e}}))},[]),S=(0,n.useCallback)(e=>{t(t=>({...t,export:{...t.export,...e}}))},[]),w=(0,n.useCallback)(()=>{t(f),s(null),l(null),h("location"),b("conservative")},[]),k=(0,n.useCallback)(async()=>{if(!e.city)return void l("Please select a city.");l(null),c(!0);try{var t;let a,n=function(e,t){let a=Math.round(100*(e.usableAreaM2*(t.wPerM2/1e3)*t.packingFactor))/100,s=Math.floor(1e3*a/400),n=Math.min(100,Math.round(400*s/1e3/(t.wPerM2/1e3*t.packingFactor)/e.usableAreaM2*100));return{systemKwp:a,panelCount:s,roofCoverage:n}}(e.roof,e.advanced),r=((a=e.roof.azimuthDeg-180)>180&&(a-=360),a<-180&&(a+=360),a),l=new URLSearchParams({lat:String(e.city.lat),lon:String(e.city.lon),peakpower:String(n.systemKwp),loss:String(e.advanced.systemLoss),angle:String(e.roof.tiltDeg),aspect:String(r)});e.roof.useOptimalAngles&&l.set("optimalangles","1");let o=await fetch("/api/pvgis?".concat(l.toString()));if(!o.ok){let e=await o.json().catch(()=>({error:"Unknown error"}));throw Error(null!=(t=e.error)?t:"Solar data fetch failed (".concat(o.status,")"))}let c=await o.json(),d=m(e.consumption.monthlyKwh),{savingsRange:h,monthlyBreakdown:f}=function(e,t,a,s){var n,r;let l,o,c=e.outputs.monthly.fixed.map(e=>e.E_m),d=(n=t.monthlyKwh,g.map(e=>n*e));switch(s){case"net-billing":case"conservative":default:l=i.selfConsumption.conservativeLow,o=i.selfConsumption.conservativeHigh;break;case"profile":l=i.selfConsumption.profileLow,o=i.selfConsumption.profileHigh}let h=[],p=0,f=0,b=0,v=0;for(let e=0;e<12;e++){let t=null!=(r=c[e])?r:0,n=d[e],i=Math.min(t*l,n),g=Math.min(t*o,n),y=Math.max(0,t-g),j=Math.max(0,t-i),N=m(n),S=u(n,i),w=u(n,g),k=N.monthlyBill-S.monthlyBill,C=N.monthlyBill-w.monthlyBill;"net-billing"===s&&a.enabled&&null!==a.creditRatePerKwh&&(k+=y*a.creditRatePerKwh,C+=j*a.creditRatePerKwh),k=Math.max(0,k),C=Math.max(0,C),p+=k,f+=C,b+=i,v+=g,h.push({month:x[e],monthNum:e+1,productionKwh:Math.round(t),consumptionKwh:Math.round(n),selfConsumedMinKwh:Math.round(i),selfConsumedMaxKwh:Math.round(g),exportedMinKwh:Math.round(y),exportedMaxKwh:Math.round(j),savingsMinSar:Math.round(k),savingsMaxSar:Math.round(C)})}return{savingsRange:{minSarPerYear:Math.round(p),maxSarPerYear:Math.round(f),minKwhSelfConsumedPerYear:Math.round(b),maxKwhSelfConsumedPerYear:Math.round(v),selfConsumptionRangePct:[100*l,100*o]},monthlyBreakdown:h}}(c,e.consumption,e.export,p),b=c.outputs.totals.fixed.E_y,v=e.advanced.installCostPerKwp>0?function(e,t,a,s,n){let r=e.systemKwp*t.installCostPerKwp,l=e.systemKwp*t.omCostPerKwpPerYear,o=(s+n)/2,c=i.economics.discountRatePercent/100,d=t.projectLifeYears,m=t.degradationPct/100,u=r/Math.max(o-l,1),x=-r,h=0;for(let e=1;e<=d;e++){let t=Math.pow(1-m,e-1),s=Math.pow(1+c,e);x+=(o*t-l)/s,h+=a*t/s}let p=r/Math.max(h,1),g=function(e,t,a,s,n){let r=.1;for(let l=0;l<20;l++){let l=-e,i=0;for(let e=1;e<=s;e++){let s=(t-a)*Math.pow(1-n,e-1);l+=s/Math.pow(1+r,e),i-=e*s/Math.pow(1+r,e+1)}if(.01>Math.abs(l)||0===i)break;(r-=l/i)<-.99&&(r=-.99),r>10&&(r=10)}return r>-.99?100*r:0}(r,o,l,d,m),f=a*i.economics.gridCO2IntensityKgPerKwh/1e3,b=e.panelCount>0?r/e.panelCount:0,v=e.systemKwp>0?r/e.systemKwp:0,y=-r;for(let e=0;e<25;e++)y+=o*Math.pow(1-m,e)-l;return{simplePaybackYears:Math.round(10*u)/10,npv25Years:Math.round(x),irr:Math.round(10*g)/10,lcoe:Math.round(1e3*p)/1e3,totalInstallCostSar:Math.round(r),annualSavingsRangeMin:s,annualSavingsRangeMax:n,co2OffsetTonsPerYear:Math.round(10*f)/10,costPerPanel:Math.round(b),costPerKwp:Math.round(v),cumulativeSavings25yr:Math.round(y),monthlySavingsMin:Math.round(s/12*100)/100,monthlySavingsMax:Math.round(n/12*100)/100,co2OffsetTonnesPerYear:Math.round(57e-5*a*100)/100}}(n,e.advanced,b,h.minSarPerYear,h.maxSarPerYear):null,y=(h.minSarPerYear+h.maxSarPerYear)/2,j=d.monthlyBill,N=v?v.co2OffsetTonnesPerYear:57e-5*b,S={monthsFreePerYear:j>0?y/j:0,treesEquivalentPerYear:Math.round(1e3*N/21),carTripsAvoided:Math.round(1e3*N/180),householdsEquivalent:Number((b/36e3).toFixed(1))};s({sizing:n,pvgisData:c,tariff:d,savings:h,monthlyBreakdown:f,economics:v,citizenComparisons:S,mode:p,annualProductionKwh:b,computedAt:Date.now()})}catch(e){l(e instanceof Error?e.message:"Estimation failed. Please try again.")}finally{c(!1)}},[e,p]);return{inputs:e,result:a,error:r,isLoading:o,step:d,savingsMode:p,setStep:h,setSavingsMode:b,updateCity:v,updateRoof:y,updateConsumption:j,updateAdvanced:N,updateExport:S,resetToDefaults:w,runEstimation:k,defaultInputs:f}}(),{result:t,isLoading:a,error:r}=e;return(0,s.jsxs)("div",{className:"min-h-screen",style:{backgroundColor:"var(--bg-primary)"},children:[(0,s.jsx)("header",{className:"sticky top-0 z-40 shadow-sm border-b",style:{backgroundColor:"var(--bg-secondary)",borderColor:"var(--border)",backdropFilter:"blur(8px)"},children:(0,s.jsxs)("div",{className:"max-w-6xl mx-auto px-4 py-3 flex items-center justify-between",children:[(0,s.jsxs)("div",{className:"flex items-center gap-2",children:[(0,s.jsx)("span",{className:"text-2xl",children:"☀️"}),(0,s.jsxs)("div",{children:[(0,s.jsx)("h1",{className:"text-sm font-bold leading-tight",style:{color:"var(--text-primary)"},children:"Saudi Solar Estimator"}),(0,s.jsx)("p",{className:"text-xs hidden sm:block",style:{color:"var(--text-secondary)"},children:"Free \xb7 PVGIS data \xb7 SEC tariffs \xb7 No account needed"})]})]}),(0,s.jsxs)("div",{className:"flex items-center gap-2 text-xs",style:{color:"var(--text-secondary)"},children:[(0,s.jsx)("span",{className:"hidden md:inline",children:"Data:"}),(0,s.jsx)("span",{className:"bg-blue-50 text-blue-700 px-2 py-0.5 rounded-full text-xs font-medium",children:"PVGIS (JRC)"}),(0,s.jsx)("span",{className:"bg-green-50 text-green-700 px-2 py-0.5 rounded-full text-xs font-medium",children:"SEC Tariff"}),(0,s.jsx)(ei,{})]})]})}),(0,s.jsx)("main",{className:"max-w-6xl mx-auto px-4 py-6",children:(0,s.jsxs)("div",{className:"grid grid-cols-1 lg:grid-cols-3 gap-6",children:[(0,s.jsxs)("div",{className:"lg:col-span-1",children:[(0,s.jsx)(A,{estimator:e}),(0,s.jsxs)("div",{className:"lg:hidden mt-6",children:[a&&(0,s.jsx)(el,{}),r&&(0,s.jsxs)("div",{className:"rounded-xl bg-red-50 border border-red-200 p-4 text-sm text-red-700",children:[(0,s.jsx)("p",{className:"font-medium",children:"Error fetching solar data"}),(0,s.jsx)("p",{className:"mt-1 text-red-600",children:r}),(0,s.jsx)("p",{className:"mt-2 text-xs text-red-500",children:"If this persists, PVGIS may be temporarily unavailable. Try again in a few minutes."})]}),t&&!a&&(0,s.jsx)(ec,{estimator:e}),!t&&!a&&!r&&(0,s.jsx)(ed,{})]})]}),(0,s.jsxs)("div",{className:"hidden lg:block lg:col-span-2",children:[a&&(0,s.jsx)(el,{}),r&&(0,s.jsxs)("div",{className:"rounded-xl bg-red-50 border border-red-200 p-5 text-sm text-red-700",children:[(0,s.jsx)("p",{className:"font-semibold text-base",children:"Could not fetch solar data"}),(0,s.jsx)("p",{className:"mt-1",children:r}),(0,s.jsx)("p",{className:"mt-2 text-xs text-red-500",children:"PVGIS (the European Commission solar database) may be temporarily unavailable. Please try again in a few minutes. Your inputs are preserved."})]}),t&&!a&&(0,s.jsx)(ec,{estimator:e}),!t&&!a&&!r&&(0,s.jsx)(ed,{})]})]})}),(0,s.jsx)("footer",{className:"mt-12 border-t",style:{backgroundColor:"var(--bg-secondary)",borderColor:"var(--border)"},children:(0,s.jsxs)("div",{className:"max-w-6xl mx-auto px-4 py-6 text-xs space-y-1",style:{color:"var(--text-secondary)"},children:[(0,s.jsxs)("p",{children:["Solar irradiance data from"," ",(0,s.jsx)("a",{href:"https://re.jrc.ec.europa.eu/pvgis5",className:"text-blue-600 hover:underline",target:"_blank",rel:"noopener noreferrer",children:"PVGIS v5.3 (Joint Research Centre, European Commission)"}),". Electricity tariff from"," ",(0,s.jsx)("a",{href:"https://www.se.com.sa/en-us/customers/pages/tariff.aspx",className:"text-blue-600 hover:underline",target:"_blank",rel:"noopener noreferrer",children:"Saudi Electricity Company (SEC)"}),". Self-consumption range from Fraunhofer ISE."]}),(0,s.jsx)("p",{style:{color:"var(--text-secondary)",opacity:.7},children:"Estimates only — not financial advice. Verify with a qualified solar installer before investing. Export credit rate is never assumed by this tool."})]})})]})}function ec(e){let{estimator:t}=e,{result:a,inputs:n}=t;return a?(0,s.jsxs)("div",{className:"space-y-5",children:[(0,s.jsx)(K,{result:a}),a.citizenComparisons&&(0,s.jsx)(et,{comparisons:a.citizenComparisons}),a.economics&&(0,s.jsx)(Z,{economics:a.economics}),(0,s.jsx)(H,{data:a.monthlyBreakdown}),(0,s.jsxs)("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-5",children:[(0,s.jsx)(Q,{usableAreaM2:n.roof.usableAreaM2,systemKwp:a.sizing.systemKwp,roofCoverage:a.sizing.roofCoverage,panelCount:a.sizing.panelCount}),(0,s.jsx)(X,{estimator:t})]}),(0,s.jsx)(ea,{result:a,inputs:n})]}):null}function ed(){return(0,s.jsxs)("div",{className:"flex flex-col items-center justify-center h-64 rounded-xl border-2 border-dashed text-center px-8",style:{borderColor:"var(--border)"},children:[(0,s.jsx)("span",{className:"text-4xl mb-3",children:"☀️"}),(0,s.jsx)("p",{className:"font-medium",style:{color:"var(--text-primary)"},children:"Your results will appear here"}),(0,s.jsx)("p",{className:"text-sm mt-1",style:{color:"var(--text-secondary)"},children:"Complete the 4-step wizard and click “Calculate My Solar Savings”"})]})}}},e=>{e.O(0,[279,441,255,358],()=>e(e.s=2234)),_N_E=e.O()}]);